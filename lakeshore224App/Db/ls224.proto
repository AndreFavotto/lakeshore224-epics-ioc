##################################################
# Protocol file for Lakeshore 224
# Based on protocol file for Lakeshore 336 from Diamond Light Source
#
##################################################
#INPUTS:A, B, C1-C5, D1-D5
##################################################

# General Settings
##################################################

Terminator = "\r\n";
ReplyTimeout = 1000;

##################################################

# /// Read the device ID
getID {
   out "*IDN?";
   in "LSCI,%s";
}

# /// Read the model number
getMODEL {
   in "LSCI,%8c,%*15c,%*s";
}

# /// Read the serial number
getSERIAL {
   in "LSCI,%*8c,%15c,%*s";
}

# /// Read the device firmware number
getFIRMWARE {
   in "LSCI,%*8c,%*15c,%s";
}

# /// Read the temperature in kelvin for inputs
getKRDG {
   out "KRDG? \$1";
   in "%f";
}

# /// Read the voltage input for inputs
getSRDG {
   out "SRDG? \$1";
   in "%f";
}

# /// Read the input sensor name
getINNAME {
   out "INNAME? \$1";
   in "%#s";
}

# /// Read the alarm status
# /// The first param is the input number, the second is the alarm low record.
getALARMST {
   out "ALARMST? \$1";
   in "%d,%(\$2)d";
}

# /// Read the alarm params. I put the ends of the PV names here
# /// to make the initial record INP link short.
getALARM {
   out "ALARM? \$1";
   in "%(\$2:OnOff-RB)d,%(\$2:HighVal-RB)f,%(\$2:LowVal-RB)f,%(\$2:DeadBand-RB)f,%(\$2:LE-RB)d,%(\$2:Sound-RB)d,%(\$2:Visible-RB)d";
}

setALARM{
   out "ALARM \$1,%(\$2:OnOff)d,%(\$2:HighVal)f,%(\$2:LowVal)f,%(\$2:DeadBand)f,%(\$2:LE)d,%(\$2:Sound)d,%(\$2:Visible)d";
}

# /// Read the input reading status
getRDGST {
   out "RDGST? \$1";
   in "%d";
}

# /// Read the input curve number
getINCRV {
   out "INCRV? \$1";
   in "%d";
}

# /// Read the input type params. The ends of the PV names were put here
# /// to make the initial record INP link short.
getINTYPE {
   out "INTYPE? \$1";
   in "%(\$2:S)d,%(\$2:AR)d,%(\$2:R)d,%(\$2:C)d,%(\$2:U)d";
}

# /// Set the input sensor name
setINNAME {
  out "INNAME \$1,\"%s\"";
  @init { getINNAME; }
}